<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerador de Contratos ‚Äî Inova Inox (Web)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Docx + Utils -->
  <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.7/dist/pizzip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.7/dist/pizzip-utils.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docxtemplater@3.42.0/build/docxtemplater.js"></script>

  <!-- docx-preview (renderiza HTML) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docx-preview@0.3.1/dist/docx-preview.css">
  <script src="https://cdn.jsdelivr.net/npm/docx-preview@0.3.1/dist/docx-preview.min.js"></script>

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <!-- √çcones -->
  <script defer src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <style>
    .progress-striped{background-image:linear-gradient(45deg,rgba(255,255,255,.25)25%,transparent25%,transparent50%,rgba(255,255,255,.25)50%,rgba(255,255,255,.25)75%,transparent75%,transparent);background-size:1rem 1rem;animation:progress 1s linear infinite}
    @keyframes progress{from{background-position:1rem 0}to{background-position:0 0}}
    @media print {
      @page { size: A4; margin: 20mm; }
      body * { visibility: hidden; }
      #print-area, #print-area * { visibility: visible; }
      #print-area { position: absolute; left: 0; top: 0; width: 100%; }
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-900 min-h-screen antialiased">
  <div class="max-w-6xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl md:text-3xl font-semibold">Gerador de Contratos (Web)</h1>
      <div class="text-sm text-gray-500">Rodando 100% no navegador</div>
    </header>

    <!-- Sele√ß√£o de Empresa -->
    <section id="company-grid" class="grid md:grid-cols-2 gap-4">
      <button data-company="InovaInox" class="company-card rounded-2xl bg-white shadow p-6 border hover:shadow-lg transition">
        <div class="flex items-center gap-3">
          <i data-lucide="building-2" class="w-6 h-6"></i>
          <div>
            <div class="font-semibold text-lg">Inova Inox</div>
            <div class="text-gray-500 text-sm">Contrato, OS e Capa</div>
          </div>
        </div>
      </button>
    </section>

    <!-- √Årea de configura√ß√£o -->
    <section id="config-step" class="hidden mt-8">
      <div class="flex items-center justify-between mb-5">
        <button id="btn-back" class="text-sm border rounded-lg px-3 py-1.5">‚Üê Voltar</button>
        <h2 class="text-xl font-semibold">Inova Inox</h2>
      </div>

      <div class="bg-white rounded-2xl shadow border p-5">
        <div class="font-medium mb-3">Selecione o documento:</div>
        <div id="doc-options" class="space-y-2 text-sm">
          <label class="flex items-center gap-2"><input type="radio" name="doc" value="Contrato" checked> Contrato</label>
          <label class="flex items-center gap-2"><input type="radio" name="doc" value="Ordem_de_Servico"> Ordem de Servi√ßo</label>
          <label class="flex items-center gap-2"><input type="radio" name="doc" value="Capa"> Capa</label>
        </div>

        <div class="mt-5 grid md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium">Nome do cliente</label>
            <input id="nome" class="w-full rounded-xl border px-3 py-2" placeholder="NOME_CONTRATANTE" />
          </div>
          <div>
            <label class="text-sm font-medium">Valor total</label>
            <input id="valor" class="w-full rounded-xl border px-3 py-2" placeholder="VALOR_TOTAL" />
          </div>
        </div>

        <div class="flex justify-end mt-6">
          <button id="btn-generate" class="bg-black text-white rounded-xl px-5 py-2.5">Gerar PDF</button>
        </div>
      </div>

      <div id="preview-box" class="hidden mt-8 bg-white border rounded-2xl shadow p-5">
        <div class="flex justify-between items-center mb-3">
          <h3 class="font-medium">Pr√©-visualiza√ß√£o</h3>
          <button id="btn-print" class="border rounded-lg px-3 py-1.5 text-sm">üñ®Ô∏è Salvar como PDF</button>
        </div>
        <div id="print-area" class="docx-preview"></div>
      </div>
    </section>

    <footer class="text-center text-xs text-gray-400 mt-10">
      Templates DOCX ‚Üí PDF via navegador (window.print)
    </footer>
  </div>

  <script>
    const el = s => document.querySelector(s);

    // Inicializa√ß√£o
    document.addEventListener("DOMContentLoaded", () => {
      if (window.lucide) window.lucide.createIcons();

      // Selecionar empresa
      document.querySelectorAll(".company-card").forEach(btn => {
        btn.addEventListener("click", () => {
          el("#company-grid").classList.add("hidden");
          el("#config-step").classList.remove("hidden");
        });
      });

      // Voltar
      el("#btn-back").addEventListener("click", () => {
        el("#config-step").classList.add("hidden");
        el("#company-grid").classList.remove("hidden");
      });

      // Gerar documento
      el("#btn-generate").addEventListener("click", async () => {
        const nome = el("#nome").value || "";
        const valor = el("#valor").value || "";
        const docName = document.querySelector("input[name='doc']:checked").value;
        const url = `templates/InovaInox/${docName}.docx`;

        try {
          const response = await fetch(url);
          const blob = await response.blob();
          const arrayBuffer = await blob.arrayBuffer();
          const zip = new PizZip(arrayBuffer);
          const doc = new window.docxtemplater().loadZip(zip);

          doc.setData({
            NOME_CONTRATANTE: nome,
            VALOR_TOTAL: valor,
            DATA_EMISSAO_CONTRATO: new Date().toLocaleDateString("pt-BR")
          });

          doc.render();
          const out = doc.getZip().generate({ type: "blob" });

          const container = el("#print-area");
          container.innerHTML = "";
          el("#preview-box").classList.remove("hidden");
          window.docx.renderAsync(out, container, null, { inWrapper: false, ignoreWidth: false });

          confetti({ particleCount: 100, spread: 60, origin: { y: 0.7 } });
        } catch (err) {
          alert("Erro ao gerar documento: " + err.message);
          console.error(err);
        }
      });

      // Salvar como PDF (abre janela nativa)
      el("#btn-print").addEventListener("click", () => {
        window.print();
      });
    });
  </script>
</body>
</html>
